<!DOCTYPE html>
<html>
    <head>
    <title>Gondola Test Execution Report</title>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.1/css/lightbox.min.css" >
    <style type="text/css">
      .panel-heading {
    padding: 0;
}

.panel-heading a {
    padding: 10px 5px;
    display: block;
    position: relative;
    text-decoration: none;
}

.panel-heading i.glyphicon-chevron-down {
    display: none;
}

.panel-heading i.glyphicon-chevron-right {
    display: inline-block;
}

.panel-heading.open i.glyphicon-chevron-down {
    display: inline-block;
}

.panel-heading.open i.glyphicon-chevron-right {
    display: none;
}

.info {
    text-align: right;
    padding-bottom: 10px;
}

.panel-title b {
    padding-right: 10px;
}

.panel-heading .label-container {
    position: absolute;
    top: 8px;
    right: 8px;
}

.panel-heading .label-container label {
    margin-left: 5px;
    padding: 5px;
}

.navbar .label-container {
    position: absolute;
    right: 10px;
    top: 14px;
}

.navbar {
    margin-bottom: 10px;
}

.navbar .label {
    font-size: 20px;
}

.navbar .project-name {
    position: absolute;
    top: 10px;
    /* left: 50%; */
    /* margin-left: -700px; */
    text-align: center;
    font-size: 20px;
    font-weight: bold;
}

.chart {
    padding-bottom: 15px;
}

div.chart div div svg rect {
    fill: #f5f5f5;
}

table.arguments {
    margin-left: 30px;
}

.screenshot {
    padding: 2% 0 2% 0;
}

.scenarioTitle {
    width: 80%
}

.description {
    background-color: white;
    border-color: white;
    line-height: 1.6;
    color: #6f6f6f;
    font-weight: 400;
    font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif;
    font-size: 14px;
    padding:  0.1em 0.5em 1.2em 1.5em
}

#scenario-description {
    padding-bottom:  1em;
    padding-left: 0.2em;
}

.scrollBar {
    overflow-x: scroll;
}

table {
    border-collapse: collapse;
}

table, th, td {
    border: 1px solid black;
}

th, td {
    text-align: left;
    padding: 8px;
}

th {
    background-color: #f5f5f5;
    color: black;
}

.info {
    background-color: #fbfbfb;
}

.step-duration {
    float: right;
}

.footer-div {
    text-align: right;
    vertical-align: middle;
    height:3.5%;
    width:100%;
}

.footer-container {
    margin-right: 10px;
    margin-top: 5px;
    width:18%;
    z-index: 10;
    position: absolute;
    right: 0;
    bottom: 10px;
    text-align: center;
    background-color: transparent;
}

.footer-link {
    font-size: 13px;
    float: right;
}

.footer-link:hover {
    color: darkgray;
}

.col-lg-11 {
    width: 100%;
}

.generated-on {
    text-align: right;
    padding-bottom: 10px;
}
font.label-danger {
       color: red;
	   background-color: transparent;
}

font.label-success {
       color: green;
	   background-color: transparent;
}
.exception {
    color: #aa0000;
    word-wrap: normal;
	font-family: monospace;
	white-space: pre-wrap;
}

    </style>
    <meta charset="UTF-8">
  </head>
  <body onLoad="init()">
    <script>/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/. */


function toArray(iter) {
    if (iter === null) {
        return null;
    }
    return Array.prototype.slice.call(iter);
}

function find(selector, elem) {
    if (!elem) {
        elem = document;
    }
    return elem.querySelector(selector);
}

function find_all(selector, elem) {
    if (!elem) {
        elem = document;
    }
    return toArray(elem.querySelectorAll(selector));
}

function sort_column(elem) {
    toggle_sort_states(elem);
    var colIndex = toArray(elem.parentNode.childNodes).indexOf(elem);
    var key;
    if (elem.classList.contains('numeric')) {
        key = key_num;
    } else if (elem.classList.contains('result')) {
        key = key_result;
    } else {
        key = key_alpha;
    }
    sort_table(elem, key(colIndex));
}

function show_all_extras() {
    find_all('.col-result').forEach(show_extras);
}

function hide_all_extras() {
    find_all('.col-result').forEach(hide_extras);
}

function show_extras(colresult_elem) {
    var extras = colresult_elem.parentNode.nextElementSibling;
    var expandcollapse = colresult_elem.firstElementChild;
    extras.classList.remove("collapsed");
    expandcollapse.classList.remove("expander");
    expandcollapse.classList.add("collapser");
}

function hide_extras(colresult_elem) {
    var extras = colresult_elem.parentNode.nextElementSibling;
    var expandcollapse = colresult_elem.firstElementChild;
    extras.classList.add("collapsed");
    expandcollapse.classList.remove("collapser");
    expandcollapse.classList.add("expander");
}

function show_filters() {
    var filter_items = document.getElementsByClassName('filter');
    for (var i = 0; i < filter_items.length; i++)
        filter_items[i].hidden = false;
}

function add_collapse() {
    // Add links for show/hide all
    var resulttable = find('table#results-table');
    var showhideall = document.createElement("p");
    showhideall.innerHTML = '<a href="javascript:show_all_extras()">Show all details</a> / ' +
                            '<a href="javascript:hide_all_extras()">Hide all details</a>';
    resulttable.parentElement.insertBefore(showhideall, resulttable);

    // Add show/hide link to each result
    find_all('.col-result').forEach(function(elem) {
        var collapsed = get_query_parameter('collapsed') || 'Passed';
        var extras = elem.parentNode.nextElementSibling;
        var expandcollapse = document.createElement("span");
        if (collapsed.includes(elem.innerHTML)) {
            extras.classList.add("collapsed");
            expandcollapse.classList.add("expander");
        } else {
            expandcollapse.classList.add("collapser");
        }
        elem.appendChild(expandcollapse);

        elem.addEventListener("click", function(event) {
            if (event.currentTarget.parentNode.nextElementSibling.classList.contains("collapsed")) {
                show_extras(event.currentTarget);
            } else {
                hide_extras(event.currentTarget);
            }
        });
    })
}

function get_query_parameter(name) {
    var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
}

function init () {
    reset_sort_headers();

    add_collapse();

    show_filters();

    toggle_sort_states(find('.initial-sort'));

    find_all('.sortable').forEach(function(elem) {
        elem.addEventListener("click",
                              function(event) {
                                  sort_column(elem);
                              }, false)
    });

};

function sort_table(clicked, key_func) {
    var rows = find_all('.results-table-row');
    var reversed = !clicked.classList.contains('asc');
    var sorted_rows = sort(rows, key_func, reversed);
    /* Whole table is removed here because browsers acts much slower
     * when appending existing elements.
     */
    var thead = document.getElementById("results-table-head");
    document.getElementById('results-table').remove();
    var parent = document.createElement("table");
    parent.id = "results-table";
    parent.appendChild(thead);
    sorted_rows.forEach(function(elem) {
        parent.appendChild(elem);
    });
    document.getElementsByTagName("BODY")[0].appendChild(parent);
}

function sort(items, key_func, reversed) {
    var sort_array = items.map(function(item, i) {
        return [key_func(item), i];
    });
    var multiplier = reversed ? -1 : 1;

    sort_array.sort(function(a, b) {
        var key_a = a[0];
        var key_b = b[0];
        return multiplier * (key_a >= key_b ? 1 : -1);
    });

    return sort_array.map(function(item) {
        var index = item[1];
        return items[index];
    });
}

function key_alpha(col_index) {
    return function(elem) {
        return elem.childNodes[1].childNodes[col_index].firstChild.data.toLowerCase();
    };
}

function key_num(col_index) {
    return function(elem) {
        return parseFloat(elem.childNodes[1].childNodes[col_index].firstChild.data);
    };
}

function key_result(col_index) {
    return function(elem) {
        var strings = ['Error', 'Failed', 'Rerun', 'XFailed', 'XPassed',
                       'Skipped', 'Passed'];
        return strings.indexOf(elem.childNodes[1].childNodes[col_index].firstChild.data);
    };
}

function reset_sort_headers() {
    find_all('.sort-icon').forEach(function(elem) {
        elem.parentNode.removeChild(elem);
    });
    find_all('.sortable').forEach(function(elem) {
        var icon = document.createElement("div");
        icon.className = "sort-icon";
        icon.textContent = "vvv";
        elem.insertBefore(icon, elem.firstChild);
        elem.classList.remove("desc", "active");
        elem.classList.add("asc", "inactive");
    });
}

function toggle_sort_states(elem) {
    //if active, toggle between asc and desc
    if (elem.classList.contains('active')) {
        elem.classList.toggle('asc');
        elem.classList.toggle('desc');
    }

    //if inactive, reset all other functions and add ascending active
    if (elem.classList.contains('inactive')) {
        reset_sort_headers();
        elem.classList.remove('inactive');
        elem.classList.add('active');
    }
}

function is_all_rows_hidden(value) {
  return value.hidden == false;
}

function filter_table(elem) {
    var outcome_att = "data-test-result";
    var outcome = elem.getAttribute(outcome_att);
    class_outcome = outcome + " results-table-row";
    var outcome_rows = document.getElementsByClassName(class_outcome);

    for(var i = 0; i < outcome_rows.length; i++){
        outcome_rows[i].hidden = !elem.checked;
    }

    var rows = find_all('.results-table-row').filter(is_all_rows_hidden);
    var all_rows_hidden = rows.length == 0 ? true : false;
    var not_found_message = document.getElementById("not-found-message");
    not_found_message.hidden = !all_rows_hidden;
}
</script>
   <!-- header !-->
	<div class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <div class="project-name visible-md visible-lg">Gondola Test Execution Report</div>
          <div class="label-container">
            <span class="label label-success" title="${HEL_MAPPED_SPEC_TITLE}">Passed: ${HEL_NUM_OF_PASSED}</span>
            <span class="label label-danger" title="${HEL_MAPPED_SPEC_TITLE}">Failed: ${HEL_NUM_OF_FAILED}</span> 
            <span class="label label-danger" title="${HEL_MAPPED_SPEC_TITLE}">Error: ${HEL_NUM_OF_ERROR}</span>
            <span class="label label-warning" title="${HEL_MAPPED_SPEC_TITLE}">Skipped: ${HEL_NUM_OF_SKIPPED}</span> 
			<span class="label label-info">Time Elapsed: ${HEL_TEST_DURATION}</span>
          </div>
        </div>
      </div>
    </div>
	
   <!-- container !-->
   <div class="container">
   <div class="generated-on">${HEL_TEST_STARTTIME}</div>
   <!--<div class="generated-on"><b>Platform:</b> Windows NT</div>
      <div class="info"><b>Browser:</b> chrome 61.0.3163.100</div>
      <div class="info"><b>Generated on:</b> 2017-10-23 11:58:19</div>-->
   <div class="row">
      <div class="chart col-lg-4 col-md-4" id="piechart_${HEL_MAPPED_SUITE_TITLE}"></div>
      <div class="chart col-lg-4 col-md-4" id="piechart_${HEL_MAPPED_SPEC_TITLE}"></div>
      <!--div class="chart col-lg-4 col-md-4" id="piechart_CheckPoints"></div-->
   </div>
   <div class="panel panel-default">
      <div class="panel-heading">
         <h4 class="panel-title">
            <a data-toggle="collapse" href="#logOutput">
            <i class="glyphicon glyphicon-chevron-right"></i>
            <i class="glyphicon glyphicon-chevron-down"></i>
            <b>Environment</b>
            </a>
         </h4>
      </div>
      <div id="logOutput" class="panel-collapse collapse">
         <div class="panel-body">
            <div class="row">
               <div class="clearfix metadata col-xs-12 col-sm-6 col-md-6 col-lg-6">
                  <div class="pull-left">
                     <strong> Browser: </strong>${HEL_ENV_ENTRIES}
                  </div>
                  <div class="pull-right">
                     <strong> Platform: </strong>${HEL_PLATFORM}
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="row">
      <div class="col-lg-11 col-md-6">
		<!-- this div contain the test suite!-->
		${HEL_TEST_DETAIL}
      </div>
   </div>
</div>
   <!-- end !-->
   <!-- script !-->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.1/js/lightbox.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
   google.charts.load("current", {packages:["corechart"]});
   google.charts.setOnLoadCallback(function() {drawChart({
                                                           "title": "${HEL_MAPPED_SUITE_TITLE}",
                                                           "passed": ${HEL_NUM_OF_PASSED_SUITES},
                                                           "failed": ${HEL_NUM_OF_FAILED_SUITES},
     })
   });
   google.charts.setOnLoadCallback(function() {drawChart({
                                                           "title": "${HEL_MAPPED_SPEC_TITLE}",
                                                           "passed": ${HEL_NUM_OF_PASSED},
                                                           "skipped": ${HEL_NUM_OF_SKIPPED},
                                                           "errors": ${HEL_NUM_OF_ERROR},
                                                           "failed": ${HEL_NUM_OF_FAILED}
     })
   });
//    google.charts.setOnLoadCallback(function() {drawChart({
//                                                            "title": "CheckPoints",
//                                                            "passed": ${HEL_NUM_OF_PASSED_CHECKPOINTS},
//                                                            "skipped": ${HEL_NUM_OF_SKIPPED_CHECKPOINTS},
//                                                            "errors": ${HEL_NUM_OF_ERROR_CHECKPOINTS},
//                                                            "failed": ${HEL_NUM_OF_FAILED_CHECKPOINTS}
//      })
//    });
   
</script>
<script>
   function drawChart(chartData) {
   var data = google.visualization.arrayToDataTable([
   ['Task', 'Project Results'],
   ['Passed', chartData.passed],
   ['Skipped', chartData.skipped],
   ['Errors', chartData.errors],
   ['Failed', chartData.failed]
   ]);
   
   var testsNumber = chartData.passed + chartData.failed + (chartData.skipped || 0) + (chartData.errors || 0);
   var title;
   
   if (testsNumber === 1) {
   title = testsNumber + ' ' + chartData.title;
   } else {
   title = testsNumber + ' ' + chartData.title + 's';
   }
   
   var options = {
   width: '100%',
   height: 270,
   title: title,
   is3D: true,
   fontSize: '12',
   colors: ['#5cb85c', '#f0ad4e', '#5bc0de', '#d9534f'],
   pieStartAngle: 100,
   backgroundColor: 'white',
   titleTextStyle: {
   fontSize: '13',
   color: '#5e5e5e'
   }
   };
   
   var chart = new google.visualization.PieChart(document.getElementById('piechart_' + chartData.title));
   chart.draw(data, options);
   }
   
</script>
</body>
</html>