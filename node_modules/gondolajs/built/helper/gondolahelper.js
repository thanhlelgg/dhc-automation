"use strict";var __decorate=this&&this.__decorate||function(e,t,r,o){var a,l=arguments.length,c=l<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var n=e.length-1;n>=0;n--)(a=e[n])&&(c=(l<3?a(c):l>3?a(t,r,c):a(t,r))||c);return l>3&&c&&Object.defineProperty(t,r,c),c},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const assert_1=__importDefault(require("assert")),codeceptjs=require("codeceptjs"),errors=__importStar(require("../errors")),message_1=require("../message"),util_1=require("../util"),deco_1=require("../deco"),recorder=codeceptjs.recorder,HELPERS_NAME=["Protractor","Puppeteer","WebDriverIO","Nightmare","Appium"],MOBILE_HELPER="Appium",jp=require("jsonpath"),ElementNotFound=require("codeceptjs/lib/helper/errors/ElementNotFound");class GondolaHelper extends Helper{async click(e,t){await this._getHelper().click(e,t)}async getElementCount(e){return await this._getHelper().grabNumberOfVisibleElements(e)}async getText(e){const t=await this._getHelper().grabTextFrom(e);return t instanceof Array?t[0]:t}async checkText(e,t){const r=await this.getText(e),o=message_1.localize(errors.GErrorKey.ValueNotMatch);assert_1.default.strictEqual(r,t,o)}async closeCurrentTab(){await this._getHelper().closeCurrentTab()}async closeOtherTabs(){await this._getHelper().closeOtherTabs()}async doesControlExist(e){try{return await this._getHelper().seeElement(e),!0}catch(e){if("Element locator cannot be empty."===e.message)throw e;return!1}}async enter(e,t){await this._getHelper().fillField(e,t)}async navigate(e){const t=this._getHelper(),r=t.browser;if(!r)throw new errors.BrowserNotFoundError;r.get?await r.get(e):await t.amOnPage(e)}async openNewTab(){await this._getHelper().openNewTab()}async checkWindowExist(e){await this._getHelper().seeTitleEquals(e)}async checkControlExist(e){await this._getHelper().seeElement(e)}async checkControlNotExist(e){await this._getHelper().dontSeeElement(e)}async waitForElement(e,t){this._assertTimeValue(t),await this._getHelper().waitForElement(e,t)}async deleteCookie(e){this._getHelper().clearCookie(e)}async executeScript(e){const t=this._getHelper();return await t.executeScript(e)}async maximize(){const e=this._getHelper();await e.resizeWindow("maximize")}async checkControlProperty(e,t,r){try{const o=await this.getControlProperty(e,t),a=message_1.localize(errors.GErrorKey.InvalidValue);assert_1.default.strictEqual(o,r,a)}catch(e){throw e}}async getControlProperty(e,t){const r=this._getHelper();if(!t)throw new errors.GError(errors.GErrorKey.PropertyNameEmpty);try{const o=await r.grabAttributeFrom(e,t);return o instanceof Array?o[0]:o}catch(e){throw e}}async getElementsAttribute(e,t){const r=this._getHelper();try{return await r.grabAttributeFrom(e,t)}catch(e){throw e}}async select(e,t){Array.isArray(t)||(t=[t]);const r=await this._locateSelectable(e);let o=[];o=r.$$?await r.$$("option"):await r.findElements({tagName:"option"});const a=await r.getAttribute("multiple");if("true"!==a&&1!==t.length)throw new errors.GError(errors.GErrorKey.InvalidMultiSelect);for(const e of o){const r=await e.getText(),o=await e.isSelected(),l=t.includes(r);if("true"===a)(!l&&o||l&&!o)&&e.click();else if(l&&!o){e.click();break}}}async getSelectedItems(e){const t=[],r=await this._locateSelectable(e);let o=[];o=r.$$?await r.$$("option"):await r.findElements({tagName:"option"});for(const e of o)await e.isSelected()&&t.push(e.getText());return Promise.all(t)}async setState(e,t){const r=this._getHelper(),o=await r._locateCheckable(e);if(!o.length)throw new errors.GError(errors.GErrorKey.CheckableElementNotFound,util_1.getLocatorString(e));if(!0!==t&&!1!==t)throw new errors.InvalidBooleanValueError(t);{const e=o[0];await e.isSelected()!==t&&await e.click()}}async get(e){const t=this._getHelper();return await t.grabValueFrom(e)}refresh(){this._getHelper().refreshPage()}async report(e,t){const r=this.helpers.Mochawesome;if(!r)throw new errors.MochawsomeCfNotFoundError;t?await r.addMochawesomeContext({title:""===e?"Untitled":e,value:t}):await r.addMochawesomeContext(e)}async clickPopup(e){if("string"!=typeof e)throw new errors.InvalidOptionValueError(e);{const t=this._getHelper();if("ok"===e.toLowerCase())await t.acceptPopup();else{if("cancel"!==e.toLowerCase())throw new errors.InvalidOptionValueError(e);await t.cancelPopup()}}}async getPopupText(){const e=this._getHelper(),t=await e.grabPopupText();if(null==t)throw new errors.GError(errors.GErrorKey.PopupNotFound);return t}async setPopupText(e){const t=this._getHelper();try{const r=await t.browser.switchTo().alert();r&&await r.sendKeys(e)}catch(e){throw e}}async setErrorHandler(e){this.onError=e}async wait(e){this._assertTimeValue(e),await this._getHelper().wait(e)}async switchFrame(e){await this._getHelper().switchTo(e)}async switchBrowserTab(e,t){if("previous"===e.toLowerCase())await this._getHelper().switchToPreviousTab(t);else{if("next"!==e.toLocaleLowerCase())throw new errors.InvalidOptionValueError(e);await this._getHelper().switchToNextTab(t)}}async saveScreenshot(e,t){await this._getHelper().saveScreenshot(e,t)}async _failed(e){if(this.onError){const t=recorder.add;recorder.add=(e,r,o,a)=>t.call(recorder,e,r,!0,a),recorder.session.start(GondolaHelper.name+" on _failed handler (start session)");const r={errorMessage:e.err.message,testCaseName:e.title,testStepName:this.currentStep.name};await this.onError(r,actor()),recorder.session.restore(GondolaHelper.name+" on _failed handler (restore session)"),recorder.add=t,this.onError=null}}async waitForDisappear(e,t){await this._getHelper().waitForDetached(e,t)}checkEqual(e,t,r){assert_1.default.deepStrictEqual(e,t,r)}checkNotEqual(e,t,r){assert_1.default.notDeepStrictEqual(e,t,r)}getJSONValue(e,t){return jp.query(e,"$"+t)}checkJSONValue(e,t,r){const o=this.getJSONValue(e,t);assert_1.default.deepStrictEqual(o,r)}async _beforeStep(e){this.currentStep=e}_findHelper(){for(const e in this.helpers)if(this.helpers.hasOwnProperty(e)){const t=e;if(HELPERS_NAME.includes(t))return this.helpers[t]}return null}async _gondolaLocate(e,t=!1){if(util_1.isEmpty(e))throw new errors.LocatorEmptyError;let r=[];return r=await this.helperLocate.call(this,e,t)}_getHelper(){if(!this.myhelper){if(this.myhelper=this._findHelper(),!this.myhelper)throw new errors.GError(errors.GErrorKey.HelperNotFound,`${HELPERS_NAME.join(";")}`);this.myhelper.helperLocate=this.myhelper._locate,this.myhelper._locate=this._gondolaLocate}return this.myhelper}async _locateSelectable(e){const t=this._getHelper(),r=await t._locate(e);if(!r.length)throw new errors.GError(errors.GErrorKey.SelectTagNotFound,util_1.getLocatorString(e));let o;for(const e of r){if("select"===await e.getTagName()){o=e;break}}if(!o)throw new errors.GError(errors.GErrorKey.InvalidSelectTag,util_1.getLocatorString(e));return o}_assertTimeValue(e){if(e&&e<=0)throw new errors.NegativeNumberError}}__decorate([deco_1.action("click","")],GondolaHelper.prototype,"click",null),__decorate([deco_1.action("get element count","")],GondolaHelper.prototype,"getElementCount",null),__decorate([deco_1.action("get text","")],GondolaHelper.prototype,"getText",null),__decorate([deco_1.action("check text","")],GondolaHelper.prototype,"checkText",null),__decorate([deco_1.action("close current tab","")],GondolaHelper.prototype,"closeCurrentTab",null),__decorate([deco_1.action("close other tabs","")],GondolaHelper.prototype,"closeOtherTabs",null),__decorate([deco_1.action("does control exist","")],GondolaHelper.prototype,"doesControlExist",null),__decorate([deco_1.action("enter","")],GondolaHelper.prototype,"enter",null),__decorate([deco_1.action("navigate","")],GondolaHelper.prototype,"navigate",null),__decorate([deco_1.action("open new tab","")],GondolaHelper.prototype,"openNewTab",null),__decorate([deco_1.action("check window exist","")],GondolaHelper.prototype,"checkWindowExist",null),__decorate([deco_1.action("check control exist","")],GondolaHelper.prototype,"checkControlExist",null),__decorate([deco_1.action("check control not exist","")],GondolaHelper.prototype,"checkControlNotExist",null),__decorate([deco_1.action("wait for element","")],GondolaHelper.prototype,"waitForElement",null),__decorate([deco_1.action("delete cookie","")],GondolaHelper.prototype,"deleteCookie",null),__decorate([deco_1.action("execute script","")],GondolaHelper.prototype,"executeScript",null),__decorate([deco_1.action("maximize","")],GondolaHelper.prototype,"maximize",null),__decorate([deco_1.action("check control property","")],GondolaHelper.prototype,"checkControlProperty",null),__decorate([deco_1.action("get control property","")],GondolaHelper.prototype,"getControlProperty",null),__decorate([deco_1.action("get elements attribute","")],GondolaHelper.prototype,"getElementsAttribute",null),__decorate([deco_1.action("select","")],GondolaHelper.prototype,"select",null),__decorate([deco_1.action("get selected items","")],GondolaHelper.prototype,"getSelectedItems",null),__decorate([deco_1.action("set state","")],GondolaHelper.prototype,"setState",null),__decorate([deco_1.action("get","")],GondolaHelper.prototype,"get",null),__decorate([deco_1.action("refresh","")],GondolaHelper.prototype,"refresh",null),__decorate([deco_1.action("report","")],GondolaHelper.prototype,"report",null),__decorate([deco_1.action("click popup","")],GondolaHelper.prototype,"clickPopup",null),__decorate([deco_1.action("get popup text","")],GondolaHelper.prototype,"getPopupText",null),__decorate([deco_1.action("set popup text","")],GondolaHelper.prototype,"setPopupText",null),__decorate([deco_1.action("set error handler","")],GondolaHelper.prototype,"setErrorHandler",null),__decorate([deco_1.action("wait","")],GondolaHelper.prototype,"wait",null),__decorate([deco_1.action("switch frame","")],GondolaHelper.prototype,"switchFrame",null),__decorate([deco_1.action("switch browser tab","")],GondolaHelper.prototype,"switchBrowserTab",null),__decorate([deco_1.action("save screen shot","")],GondolaHelper.prototype,"saveScreenshot",null),__decorate([deco_1.action("wait for disappear","")],GondolaHelper.prototype,"waitForDisappear",null),__decorate([deco_1.action("check equal","")],GondolaHelper.prototype,"checkEqual",null),__decorate([deco_1.action("check not equal","")],GondolaHelper.prototype,"checkNotEqual",null),__decorate([deco_1.action("get json value","")],GondolaHelper.prototype,"getJSONValue",null),__decorate([deco_1.action("check json value","")],GondolaHelper.prototype,"checkJSONValue",null),module.exports=GondolaHelper;
//# sourceMappingURL=../../debug/helper/gondolahelper.js.map
