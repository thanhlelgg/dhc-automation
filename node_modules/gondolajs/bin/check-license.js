!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("path")},function(e,t,n){const r=n(4);function i(){r.checkinLicense().then(()=>{let e=r.getLicenseState();e.state===r.Status.error&&""!==e.redundancy&&r.tryCheckinLicense().then(()=>{e=r.getLicenseState()})})}setInterval(()=>{(function(e){try{return process.kill(e,0)}catch(e){return"EPERM"===e.code}})(process.ppid)||r.stop().then(()=>{process.exit()})},1e3),process.on("message",e=>{"stop"===e&&r.stop().then(()=>{process.exit()})}),""===process.env.info?!1===r.checkServerInfoPath()&&(process.send({licenseState:-2}),process.exit()):(r.setServerInfo(process.env.info),r.setSaveMode(!1)),r.setPrefixDeviceInfo("GON"),r.setSaveMode(!1),r.checkinLicense().then(()=>{let e=r.getLicenseState(),t=e.state===r.Status.valid;if(process.send({licenseState:e.state}),t&&!e.trial){let t=Number(e.heartbeat);setInterval(i,t)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);t.checkinLicense=r.checkinLicense,t.checkoutLicense=r.checkoutLicense,t.getLicenseState=r.getLicenseState,t.getServerInfo=r.getServerInfo,t.setServerInfo=r.setServerInfo,t.setSaveMode=r.setSaveMode,t.checkServerInfoPath=r.checkServerInfoPath,t.setPrefixDeviceInfo=r.setPrefixDeviceInfo,t.Status=r.Status,t.stop=r.stop,t.tryCheckinLicense=r.tryCheckinLicense},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(6),o=n(0),s=n(7),c=n(1),a=n(2),u=n(8),l=r(n(9));let f,d="",h=!1,p="";const S=10;let y=!0;const v="trial.gondolatest.com:5555";var g;!function(e){e[e.unknown=-1]="unknown",e[e.valid=0]="valid",e[e.invalid=1]="invalid",e[e.expired=2]="expired",e[e.error=3]="error",e[e.full=4]="full"}(g=t.Status||(t.Status={}));const I={host:"",port:""},x={error:"",expirDate:"",heartbeat:"",instanseId:"",redundancy:"",state:g.unknown,trial:!1};function k(){x.error="",x.expirDate="",x.heartbeat="",x.instanseId="",x.redundancy="",x.state=g.unknown,x.trial=!1}async function m(){if(l.default.needTrialCheck()&&l.default.isValid())return void(x.state=g.valid);if(""===d&&(d=T()),function(e){if(""!==e){const t=e.split(":");2===t.length&&(I.host=t[0],I.port=t[1])}}(d),y&&function(e){const t=O(),n={server:e};o.writeFile(t,JSON.stringify(n),e=>{if(e)return console.log(JSON.stringify(n)),console.log("writing to "+t),console.log(e)})}(d),d===v)return x.state=g.valid,x.expirDate="1/1/2020",x.instanseId=p+u(),void(x.trial=!0);let e;e="GON"===p?`http://${d}/license/agent/checkin`:`http://${d}/license/checkin`;const t=function(){let e;e=h?f.deviceInfo:p+u();return{userName:c.userInfo().username,currentDay:(new Date).toLocaleDateString(),clientRequestIp:s.address(),clientHostName:c.hostname(),product:"GON",deviceInfo:e,version:"2",extraInfo:{oldDeviceInfo:j()}}}();try{const n=(await i.default.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"},timeout:1e3*S})).data;"VALID_LICENSE"===n.code?(x.state=g.valid,x.expirDate=n.edition.expired,x.instanseId=t.deviceInfo,x.heartbeat=n.heartbeat,x.redundancy=function(e){let t="";if(""!==e){const n=e.split("?");2===n.length&&(t=`${n[1]}:${n[0]}`)}return t}(n.redundancy),f=t,h=!0):"EXPIRED_LICENSE"===n.code?(k(),x.state=g.expired):"FULL_LICENSE"===n.code?(k(),x.state=g.full):(k(),x.state=g.invalid)}catch(e){k(),x.error=e.message,x.state=g.error}}function _(){return x}async function D(){try{let e;""===d&&(d=T()),e="GON"===p?`http://${d}/license/agent/checkout`:`http://${d}/license/checkout`;await i.default.post(e,JSON.stringify(f),{headers:{"Content-Type":"application/json"}})}catch(e){}}function L(e){d=e}function N(){let e;e="GON"===p?a.join(c.homedir(),".gondola","gon-license.json"):a.join(c.homedir(),".gondola","ext-license.json");const t=a.dirname(e);return o.existsSync(t)||o.mkdirSync(t),e}function O(){const e=a.join(c.homedir(),".gondola","server.json"),t=a.dirname(e);return o.existsSync(t)||o.mkdirSync(t),e}function T(){let e="";try{const t=O(),n=o.readFileSync(t,"utf8");e=JSON.parse(n.toString()).server}catch(e){}return e}function j(){let e="";try{const t=N(),n=o.readFileSync(t,"utf8");e=JSON.parse(n.toString()).oldDeviceInfo}catch(e){}return e}t.checkinLicense=m,t.stop=async function(){void 0!==f&&(!function(e){const t=N(),n={oldDeviceInfo:e};o.writeFile(t,JSON.stringify(n),e=>{if(e)return console.log(JSON.stringify(n)),console.log("writing to "+t),console.log(e)})}(f.deviceInfo),await D())},t.getLicenseState=_,t.checkoutLicense=D,t.setSaveMode=function(e){y=e},t.setServerInfo=L,t.setPrefixDeviceInfo=function(e){p=e},t.checkServerInfoPath=function(){const e=a.join(c.homedir(),".gondola","server.json");return!!o.existsSync(e)},t.getServerInfo=function(){return I},t.tryCheckinLicense=async function(){if(x.state===g.error&&""!==x.redundancy){const e=d;L(x.redundancy),await m(),_().state!==g.valid&&(d=e)}}},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("ip")},function(e,t){e.exports=require("uuid/v4")},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),o=n(2);class s{constructor(){this.trialDay=new Date,this.isValid=()=>this.trialDay>=new Date,this.needTrialCheck()?this.getInfo():this.makeTrialDay()}needTrialCheck(){return r.existsSync(o.join(e,s.CONST_TRIAL_ACTIVATE_NAME.join("")))}getInfo(){const e=o.join(i.homedir(),".gondola"),t=o.join(e,".g");let n;if(r.existsSync(t))try{if(!(n=Buffer.from(r.readFileSync(t).toString(),"base64").toString("ascii")).startsWith(s.CONST_TRIAL_PREFIX.join("")))throw new Error("Invalid");{const e=new Date(n.substring(s.CONST_TRIAL_PREFIX.join("").length));if(isNaN(e.getTime()))throw new Error("Invalid");this.trialDay=e}}catch(e){}else{this.makeTrialDay();const e=o.dirname(t);r.existsSync(e)||r.mkdirSync(e),r.writeFileSync(t,Buffer.from(s.CONST_TRIAL_PREFIX.join("")+this.trialDay.toUTCString()).toString("base64"))}}makeTrialDay(){this.trialDay.setDate(this.trialDay.getDate()+30)}}s.CONST_TRIAL_PREFIX=["g","t","r"],s.CONST_TRIAL_ACTIVATE_NAME=["t","r","i","a","l",".","d","a","t"],t.default=new s}).call(this,"node_modules/gondola-license/build")}]);